---
title: "Buffered vs non-buffered spatial aggregation"
output: 
  html_document:
    theme: paper
---

In this document, I'll look at ridership assigned with and without a 10m buffer around stops. I use Anoka County as a small subset to start with. My hope is that spatial modeling techniques will render the buffer unnecessary. I want to checkout what the differences look like first. I'm going to aggregate all the way down to average daily boardings and alightings assigned to a block group. 

```{r include = FALSE}
library(data.table)
library(tigris)
library(ggplot2)
library(sf)
library(dplyr)

apc <- readRDS('data/mt-data/apc-bg-ag-sum.RDS')
setDT(apc)
apc <- apc[GEOID %like% 27003]  # GEOID for anoka
apc <- apc[, .(activity = mean(ag_board + ag_alight, na.rm = T)), by = GEOID]

apc_buff <- readRDS('data/mt-data/apc-bg-ag-buff-sum.RDS')
setDT(apc_buff)
apc_buff <- apc_buff[, .(activity = mean(ag_board + ag_alight, na.rm = T)), by = GEOID]

# block groups
options(tigris_class = 'sf')
bgs <- block_groups('MN', 'Anoka', year = 2016)
bgs <- st_transform(bgs, 32615) # for mapping
```


```{r echo = FALSE}
ggplot(bgs) +
  geom_sf() +
  theme_minimal() + 
  labs(title = 'Anoka County') +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r include = FALSE}
apc <- left_join(bgs, apc)
apc_buff <- left_join(bgs, apc_buff)
```


Need to give these the same palette to be meaninful 
```{r echo = FALSE}
ggplot(apc) +
  geom_sf(aes(fill = log(activity)))

ggplot(apc_buff) +
  geom_sf(aes(fill = log(activity)))
```

